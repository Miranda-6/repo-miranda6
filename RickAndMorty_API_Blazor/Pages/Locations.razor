@page "/location"
@using RickAndMortyApi.Dtos
@inject HttpClient httpClient

<h1 class="text-center fs-1 fw-bolder">location List</h1>

<!-- Contenedor de tarjetas -->
<div class="row row-cols-1 row-cols-md-4 g-4">
    @if (locations != null && locations.Count > 0)
    {
        @foreach (LocationDto location in locations)
        {
            <div class="col">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title text-center">
                            <a href="/location/@location.id" target="_blank">@location.name</a>
                        </h5>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <p>Cargando personajes...</p>
    }
</div>

<!-- Paginación -->
<div class="mt-3">
    <button class="btn btn-primary me-2" @onclick="PreviousPage" disabled="@(currentPage == 1)">Anterior</button>
    <button class="btn btn-primary" @onclick="NextPage">Siguiente</button>
</div>

@code {
    public List<LocationDto> locations = new List<LocationDto>();
    private int currentPage = 1; // Página actual

    protected override async Task OnInitializedAsync()
    {
        await Loadlocations();
    }

    // Método para cargar personajes de la página actual
    private async Task Loadlocations()
    {
        try 
        {
            var response = await httpClient.GetFromJsonAsync<ApiResponse<LocationDto>>($"location?page={currentPage}");
            if (response != null && response.Results != null)
            {
                locations = response.Results; // Actualiza la lista de personajes
            }
        } 
        catch (Exception ex) 
        {
            Console.WriteLine($"Error al cargar los personajes: {ex.Message}");
        }
    }

    //Avanzar a la siguiente página
    private async Task NextPage()
    {
        currentPage++;
        await Loadlocations();
    }

    //Retroceder a la página anterior
    private async Task PreviousPage()
    {
        if (currentPage > 1)
        {
            currentPage--;
            await Loadlocations();
        }
    }
}
